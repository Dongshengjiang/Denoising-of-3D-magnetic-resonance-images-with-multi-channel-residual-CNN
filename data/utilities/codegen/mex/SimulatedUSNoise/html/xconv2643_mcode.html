<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="119,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T3U3">Y</span> = xconv2(<span class="var type1" id="S3T3U6">I</span>,<span class="var type1" id="S4T4U7">G</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="119,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% function Y = xconv2(I,G)</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   I: the original image</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   G: the mask to be convoluted</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   Y: the convoluted result (by taking fft2, multiply and ifft2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="119,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   a similar version of the MATLAB conv2(I,G,'same'),  7/10/95</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   implemented by fft instead of doing direct convolution as in conv2</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   the result is almost same , differences are under 1e-10.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   However, the speed of xconv2 is much faster than conv2 when</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   gaussian kernel has large standard variation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="119,13" id="srcline13">13</a></span><span class="line"><span class="comment">%   Chenyang Xu and Jerry L. Prince, 7/10/95, 6/17/97</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   Copyright (c) 1995-97 by Chenyang Xu and Jerry L. Prince</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,15" id="srcline15">15</a></span><span class="line"><span class="comment">%   Image Analysis and Communications Lab, Johns Hopkins University</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,16" id="srcline16">16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="119,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U5">[<span class="var type1" id="S5T1U11">n</span>,<span class="var type1" id="S6T1U12">m</span>] = size(<span class="var type1" id="S3T3U15">I</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U9">[<span class="var type1" id="S8T1U19">n1</span>,<span class="var type1" id="S9T1U20">m1</span>] = size(<span class="var type1" id="S4T4U23">G</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T113:U13"><span class="var type1" id="S10T113U26">FI</span> = <span class="mxinfo " id="T113:U15">fft2(<span class="var type1" id="S3T3U29">I</span>,<span class="mxinfo " id="T1:U17"><span class="mxinfo " id="T1:U18"><span class="var type1" id="S5T1U32">n</span>+<span class="var type1" id="S8T1U33">n1</span></span>-1</span>,<span class="mxinfo " id="T1:U21"><span class="mxinfo " id="T1:U22"><span class="var type1" id="S6T1U37">m</span>+<span class="var type1" id="S9T1U38">m1</span></span>-1</span>)</span></span>;  <span class="comment">% avoid aliasing</span></span></span>
<span class="srcline"><span class="lineno"><a href="119,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T113:U25"><span class="var type1" id="S12T113U42">FG</span> = <span class="mxinfo " id="T113:U27">fft2(<span class="var type1" id="S4T4U45">G</span>,<span class="mxinfo " id="T1:U29"><span class="mxinfo " id="T1:U30"><span class="var type1" id="S5T1U48">n</span>+<span class="var type1" id="S8T1U49">n1</span></span>-1</span>,<span class="mxinfo " id="T1:U33"><span class="mxinfo " id="T1:U34"><span class="var type1" id="S6T1U53">m</span>+<span class="var type1" id="S9T1U54">m1</span></span>-1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T113:U37"><span class="var type1" id="S13T113U58">FY</span> = <span class="mxinfo " id="T113:U39"><span class="var type1" id="S10T113U60">FI</span>.*<span class="var type1" id="S12T113U61">FG</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T3:U42"><span class="var type1" id="S14T3U64">YT</span> = <span class="mxinfo " id="T3:U44">real(<span class="mxinfo " id="T113:U45">ifft2(<span class="var type1" id="S13T113U69">FY</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T1:U47"><span class="var type1" id="S17T1U72">nl</span> = <span class="mxinfo " id="T1:U49">floor(<span class="var type1" id="S8T1U76">n1</span>/2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T1:U51"><span class="var type1" id="S19T1U80">ml</span> = <span class="mxinfo " id="T1:U53">floor(<span class="var type1" id="S9T1U84">m1</span>/2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="119,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T3:U55"><span class="var type1" id="S2T3U88">Y</span> = <span class="mxinfo " id="T3:U57"><span class="var type1" id="S14T3U90">YT</span>(<span class="mxinfo " id="T114:U59"><span class="mxinfo " id="T1:U60">1+<span class="var type1" id="S17T1U94">nl</span></span>:<span class="mxinfo " id="T1:U62"><span class="var type1" id="S5T1U96">n</span>+<span class="var type1" id="S17T1U97">nl</span></span></span>,<span class="mxinfo " id="T114:U65"><span class="mxinfo " id="T1:U66">1+<span class="var type1" id="S19T1U101">ml</span></span>:<span class="mxinfo " id="T1:U68"><span class="var type1" id="S6T1U103">m</span>+<span class="var type1" id="S19T1U104">ml</span></span></span>)</span></span>;</span></span>
</pre>
